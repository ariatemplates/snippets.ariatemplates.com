/**
 * Copyright 2012 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
Aria.classDefinition({$classpath:"aria.widgets.container.Splitter",$extends:"aria.widgets.container.Container",$dependencies:["aria.utils.Dom","aria.utils.ClassList","aria.utils.dragdrop.Drag","aria.core.Browser"],$css:["aria.widgets.css."+aria.widgets.AriaSkinInterface.getSkinName()+".Splitter"],$constructor:function(a){this.$Container.constructor.apply(this,arguments);this._skinObj=aria.widgets.AriaSkinInterface.getSkinObject("Splitter",a.sclass);this._splitBarProxy=this._splitBar=this._splitBarProxyClass=
this._handleBarClass=this._height=this._splitPanel2=this._splitPanel1=null},$destructor:function(){this._splitPanel2=this._splitPanel1=this._splitBarProxy=this._splitBar=this._handleBarClass=this._height=this._skinObj=null;this._splitBarProxyClass.$dispose();this._destroyDraggable();this.$Container.$destructor.call(this)},$statics:{SPLITTER_BORDER_SIZE:2},$prototype:{initWidget:function(){this.$Container.initWidget.apply(this,arguments);var a=aria.utils.Dom.getDomElementChild,b=a(a(this.getDom(),
0),0);this._splitPanel1=a(b,0);this._splitBar=a(b,1);this._splitBarProxy=a(b,2);this._splitPanel2=a(b,3);this._splitBarProxyClass=new aria.utils.ClassList(this._splitBarProxy);a="splitBarProxy_"+this._domId;this._draggable=new aria.utils.dragdrop.Drag(a,{handle:a,cursor:"n-resize",proxy:null,constrainTo:b});this._draggable.$on({dragstart:{fn:this._onDragStart,scope:this},dragend:{fn:this._onDragEnd,scope:this}})},_onDragStart:function(){if(aria.core.Browser.isIE)this.getDom().onselectstart=Aria.returnFalse;
this._splitBarProxyClass.remove(this._handleBarClass);this._splitBarProxyClass.add("xSplitter_"+this._cfg.sclass+"_sSplitBarProxyH")},_onDragEnd:function(){this.getDom().onselectstart=Aria.returnTrue;this._splitBarProxyClass.remove("xSplitter_"+this._cfg.sclass+"_sSplitBarProxyH");this._splitBarProxyClass.add(this._handleBarClass);this._context.$refresh({outputSection:"_splitterContent1_"+this._domId});this._context.$refresh({outputSection:"_splitterContent2_"+this._domId});var a=this._draggable.element;
a=a.offsetTop<=0?0:a.offsetTop;var b=this._height-a<=0?0:this._height-a;this.setProperty("size1",a);this.setProperty("size2",b);this._splitPanel1.style.height=a+"px";this._splitPanel2.style.height=b+"px";this._splitBar.style.top=a+"px";this._splitBarProxy.style.top=a+"px"},_widgetMarkupBegin:function(a){var b=this._cfg,c=this._calculateSize(b);this.setProperty("size1",c.size1);this.setProperty("size2",c.size2);var d="",e=b.width,f=this._height+Number(this._skinObj.separatorHeight);if(b.border)d="xSplitter_"+
b.sclass+"_sBdr";this._handleBarClass=b.orientation=="horizontal"?"xSplitter_"+b.sclass+"_sHandleH":"xSplitter_"+b.sclass+"_sHandleV";a.write(['<span class="xSplitter_',b.sclass,"_sContainer ",d,'" style="height:',f,"px;width:",b.width,'px;"><span class="xSplitter_',b.sclass,'_sConstrained"  ><span class="xSplitter_',b.sclass,'_sMacro" style="height: ',c.size1,"px; width:",b.width,'px;">'].join(""));a.beginSection({id:"_splitterContent1_"+this._domId,macro:b.macro1});a.endSection();a.write("</span> ");
a.write(['<span class="',this._handleBarClass,'" style="width:',e,"px;top:",c.size1,'px; "> </span><span id="splitBarProxy_',this._domId,'" class="',this._handleBarClass,' " style="top:',c.size1,'px; width:100%;"></span><span class="xSplitter_',b.sclass,'_sMacro" style="height: ',c.size2,"px;width:",b.width,'px;bottom:0px">'].join(""));a.beginSection({id:"_splitterContent2_"+this._domId,macro:b.macro2});a.endSection();a.write("</span> </span> </span>")},_calculateSize:function(a){this._height=a.height-
this._skinObj.separatorHeight-(a.border?this.SPLITTER_BORDER_SIZE:0);if(this._height<0)this._height=0;if(a.size1<0)a.size1=0;if(a.size2<0)a.size2=0;if(a.size1==null&&a.size2==null){a.size1=Math.floor(this._height/2);a.size2=this._height-a.size1}else if(a.size1==null&&a.size2!=null)a.size1=this._height-a.size2;else if(a.size1!=null&&a.size2==null)a.size2=this._height-a.size1;var b=a.size1+a.size2,c={};if(this._height==b){c.size1=a.size1;c.size2=a.size2}else if(a.adapt=="size1"){c.size2=a.size2;if(c.size2>
this._height)c.size2=this._height;c.size1=this._height-c.size2}else if(a.adapt=="size2"){c.size1=a.size1;if(c.size1>this._height)c.size1=this._height;c.size2=this._height-c.size1}else if(b!=0){c.size1=Math.floor(this._height*a.size1/b);c.size2=this._height-c.size1}else{c.size1=Math.floor(this._height/2);c.size2=this._height-a.size1}return c},_onBoundPropertyChange:function(a,b){if(a=="size1"||a=="size2"){var c=this._height;if(b>c)b=c;if(b<0)b=0;c-=b;if(a=="size1"){this._splitPanel2.style.height=c+
"px";this._splitPanel1.style.height=b+"px";this._splitBar.style.top=b+"px";this._splitBarProxy.style.top=b+"px";this.setProperty("size1",b);this.setProperty("size2",c)}else{this._splitPanel1.style.height=c+"px";this._splitPanel2.style.height=b+"px";this._splitBar.style.top=c+"px";this._splitBarProxy.style.top=c+"px";this.setProperty("size2",b);this.setProperty("size1",c)}this._context.$refresh({outputSection:"_splitterContent1_"+this._domId});this._context.$refresh({outputSection:"_splitterContent2_"+
this._domId})}else this.$Container._onBoundPropertyChange.apply(this,arguments)},_destroyDraggable:function(){this._draggable.$removeListeners({dragstart:{fn:this._onDragStart,scope:this},dragend:{fn:this._onDragEnd,scope:this}});this._draggable.$dispose();this._draggable=null}}});