/**
 * Copyright 2012 Amadeus s.a.s.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *    http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
//***MULTI-PART
//YpwKgK3gnz
//LOGICAL-PATH:aria/popups/Beans.js
//YpwKgK3gnz
Aria.beanDefinitions({$package:"aria.popups.Beans",$description:"Definition of the JSON beans used to set application variables",$namespaces:{json:"aria.core.JsonTypes",dom:"aria.utils.DomBeans"},$beans:{PopupConf:{$type:"json:Object",$description:"Configuration object for the aria.popups.Popup",$properties:{section:{$type:"json:ObjectRef",$description:"{aria.templates.Section} The section used to create the content of the popup",$mandatory:true},keepSection:{$type:"json:Boolean",$description:"If true, the section is not disposed when the popup is closed (its content only is removed).",
$default:false},modal:{$type:"json:Boolean",$description:"If true, a mask is shown behind the popup so that mouse and keyboard interraction with elements behind the popup is not possible.",$default:false},domReference:{$type:"json:ObjectRef",$description:"{HTMLElement} The DOM reference which will be used as the reference position for the tooltip",$default:null},tagDomElement:{$type:"json:ObjectRef",$description:"{HTMLElement} The DOM element which will be used to append the popup to.",$default:null},
absolutePosition:{$type:"dom:Position",$description:"Takes priority over domReference if defined. The exact coordinates where the popup should be displayed. Anchors and offsets will still be applied",$default:null},center:{$type:"json:Boolean",$description:"If true, the popup will be in the center of the browser window. This takes priority over absolutePosition and domReference.",$default:false},closeOnMouseClick:{$type:"json:Boolean",$description:"Close the popup when the user clicks outside of the popup",
$default:true},closeOnMouseScroll:{$type:"json:Boolean",$description:"Close the popup when the user scrolls outside of the popup",$default:true},closeOnMouseOut:{$type:"json:Boolean",$description:"Close the popup when the user leaves the popup, after a delay, set in closeOnMouseOutDelay",$default:false},closeOnMouseOutDelay:{$type:"json:Integer",$description:"Delay before closing the popup when the user leaves the popup",$default:500},preferredPositions:{$type:"json:Array",$description:"Array of positions such as 'bottom right' to describe the relative position of the popup with its reference.",
$contentType:{$type:"PreferredPosition",$mandatory:true,$description:"A preferred position. The order indicates the order of preference."},$default:[{}]},offset:{$type:"OffsetConfig",$description:"Offset for displaying the popup",$default:{}},ignoreClicksOn:{$type:"json:Array",$description:"Array of HTMLElements. The popup should not close when one of the leemnts are clicked.",$contentType:{$type:"json:ObjectRef",$description:"(HTMLElement)"},$default:[{}]},parentDialog:{$type:"json:ObjectRef",$description:"[Optional] The dialog the popup belongs to",
$default:null},preferredWidth:{$type:"json:Integer",$description:"Width of the popup in px - if negative, the width is computed dynamically depending on the content.",$default:-1}}},PreferredPosition:{$type:"json:Object",$description:"Couple of anchors describing the positionning between the popup and the reference.",$properties:{reference:{$type:"json:String",$description:"Anchor of the reference to use for this position setting",$default:"bottom right"},popup:{$type:"json:String",$description:"Anchor of the reference to use for this position setting",
$default:"top left"},offset:{$type:"OffsetConfig",$description:"Offset to apply for this position"}}},OffsetConfig:{$type:"json:Object",$description:"Configuration object to describe the display offsets to adjust the position the popup",$properties:{top:{$type:"json:Integer",$description:"Offset to be applied between the top of the popup and the reference, when the popup anchor contains 'top'",$default:0},bottom:{$type:"json:Integer",$description:"Offset to be applied between the bottom of the popup and the reference, when the popup anchor contains 'bottom'",
$default:0},right:{$type:"json:Integer",$description:"Offset to be applied between the right of the popup and the reference, when the popup anchor contains 'right'",$default:0},left:{$type:"json:Integer",$description:"Offset to be applied between the left of the popup and the reference, when the popup anchor contains 'left'",$default:0}}}}});
//YpwKgK3gnz
//LOGICAL-PATH:aria/popups/Popup.js
//YpwKgK3gnz
Aria.classDefinition({$classpath:"aria.popups.Popup",$dependencies:["aria.popups.PopupManager","aria.popups.Beans","aria.DomEvent","aria.utils.Math","aria.utils.Dom","aria.utils.Size","aria.utils.Event","aria.utils.Delegate"],$events:{onBeforeClose:{description:"Event triggered before closing the event",properties:{domEvent:"{aria.DomEvent} The event that triggered the closing of the popup",cancelClose:"{Boolean} Cancel the closing of the popup"}},onMouseOutTimerStart:{description:"Event triggered when the mouseout timer",
properties:{domEvent:"{aria.DomEvent} The event that triggered the closing of the popup",cancelClose:"{Boolean} Cancel the closing of the popup"}},onAfterClose:"",onBeforeOpen:"",onAfterOpen:"",onPositioned:{description:"Triggered when position of the popup is choosen, according to prefered position provided",properties:{position:"Position choosed if any. If empty, no position in viewset was found."}}},$statics:{ANCHOR_BOTTOM:"bottom",ANCHOR_TOP:"top",ANCHOR_LEFT:"left",ANCHOR_RIGHT:"right"},$constructor:function(){this.preferredPositions=
[];this.modalMaskDomElement=null;this._delegateId=aria.utils.Delegate.add({fn:this._handleDelegate,scope:this});this.domElement=null;this.isOpen=false;this.sectionSize=this.section=this.referenceSize=this.referencePosition=this.reference=null;this.ANCHOR_KEYS=[this.ANCHOR_BOTTOM,this.ANCHOR_TOP,this.ANCHOR_LEFT,this.ANCHOR_RIGHT];this._ignoreClicksOn=null;this._rootElementOverflow=-1;this._rootElement=aria.utils.Dom.getDocumentScrollElement();this._document=Aria.$window.document;aria.popups.PopupManager.registerPopup(this)},
$destructor:function(){this.close();this.reference=null;this._delegateId&&aria.utils.Delegate.remove(this._delegateId);if(this.section){this.section.$unregisterListeners(this);this.conf.keepSection?this.section.removeContent():this.section.$dispose();this.section=null}if(this.modalMaskDomElement){aria.utils.Dom.removeElement(this.modalMaskDomElement);this.modalMaskDomElement=null}if(this.domElement){aria.utils.Dom.removeElement(this.domElement);this.domElement=null}this._document=this._ignoreClicksOn=
this._parentDialog=this.conf.domReference=null;this.$unregisterListeners();aria.popups.PopupManager.unregisterPopup(this)},$prototype:{_applyConfig:function(a){aria.core.JsonValidator.normalize({json:a,beanName:"aria.popups.Beans.PopupConf"});if(this.modalMaskDomElement){aria.utils.Dom.removeElement(this.modalMaskDomElement);this.modalMaskDomElement=null}if(a.modal)this.modalMaskDomElement=this._createMaskDomElement();this.domElement!=null&&aria.utils.Dom.removeElement(this.domElement);this.domElement=
this._createDomElement(a.tagDomElement?a.tagDomElement:null);this.setPreferredPositions(a.preferredPositions);this.setSection(a.section);a.absolutePosition===null?this.setReference(a.domReference):this.setPositionAsReference(a.absolutePosition);this._ignoreClicksOn=a.ignoreClicksOn;this._parentDialog=a.parentDialog;this.conf=a},_attachMouseOverListener:function(){this._detachMouseOverListener();aria.utils.Event.addListener(this.getDomElement(),"mouseover",{fn:this._clearMouseOutTimer,scope:this})},
_handleDelegate:function(a){a.type=="contentchange"&&this.refresh()},_createDomElement:function(a){var b=this._document,c=b.createElement("div");c.style.cssText="position:absolute;top:-15000px;left:-15000px;";b.body.appendChild(c);c.innerHTML="<div "+aria.utils.Delegate.getMarkup(this._delegateId)+" style='position:absolute;top:-15000px;left:-15000px;visibility:hidden;display:block;'></div>";var d=c.firstChild;b.body.removeChild(c);a?a.appendChild(d):b.body.appendChild(d);return d},_createMaskDomElement:function(){var a=
this._document,b=a.createElement("div");b.className="xDialogMask";b.style.cssText="position:absolute;top:-15000px;left:-15000px;visibility:hidden;display:block;";return a.body.appendChild(b)},_clearMouseOutTimer:function(){aria.core.Timer.cancelCallback(this._mouseOutTimer)},_defaultBeforeOpenCallback:function(){return true},_defaultBeforeCloseCallback:function(){return true},_detachMouseOverListener:function(){aria.utils.Event.removeListener(this.getDomElement(),"mouseover",{fn:this._clearMouseOutTimer})},
_getComputedStyle:function(){var a,b;b=this.isOpen&&this.computedStyle.zIndex?this.computedStyle.zIndex:aria.popups.PopupManager.getZIndexForPopup(this);a=this.conf.preferredWidth>0?{width:this.conf.preferredWidth,height:0}:this._getFreeSize();var c=this._getPosition(a);a={top:c.top,left:c.left,height:a.height,width:a.width,zIndex:b};if(this.conf.tagDomElement){b=aria.utils.Dom.calculatePosition(this.conf.tagDomElement);a.top-=b.top;a.left-=b.left}return a},_getFreeSize:function(){var a=this.domElement;
a.style.cssText="position:absolute;top:-15000px;left:-15000px;visibility:hidden;display:block;";return{width:aria.core.Browser.isIE9?a.offsetWidth+1:a.offsetWidth,height:a.offsetHeight}},_getPosition:function(a){var b;if(this.conf.center){b=this.conf.offset;a={width:a.width+b.left+b.right,height:a.height+b.top+b.bottom};b=aria.utils.Dom.centerInViewport(a,this.reference);b=aria.utils.Dom.fitInViewport(b,a,this.reference)}else{var c=0,d;do{b=this.preferredPositions[c];b=this._getPositionForAnchor(b,
a);d=aria.utils.Dom.isInViewport(b,a);c++}while(!d&&this.preferredPositions[c]);var e={name:"onPositioned"};if(d)e.position=this.preferredPositions[c-1];else{b=this._getPositionForAnchor(this.preferredPositions[0],a);b=aria.utils.Dom.fitInViewport(b,a)}this.$raiseEvent(e)}return b},_getPositionForAnchor:function(a,b){var c=a.reference,d=a.popup,e=this.referencePosition.top,f=this.referencePosition.left;if(c.indexOf(this.ANCHOR_BOTTOM)!=-1)e+=this.referenceSize.height;if(c.indexOf(this.ANCHOR_RIGHT)!=
-1)f+=this.referenceSize.width;c=a.offset||this.conf.offset;if(d.indexOf(this.ANCHOR_BOTTOM)!=-1){e-=b.height;e-=c.bottom}else if(d.indexOf(this.ANCHOR_TOP)!=-1)e+=c.top;if(d.indexOf(this.ANCHOR_RIGHT)!=-1){f-=b.width;f-=c.right}else if(d.indexOf(this.ANCHOR_LEFT)!=-1)f+=c.left;d=aria.utils.Dom._getDocumentScroll();f+=d.scrollLeft;e+=d.scrollTop;return{top:e,left:f}},_hide:function(){if(this.domElement){this.domElement.style.cssText="position:absolute;display:none;overflow:auto;";if(this.modalMaskDomElement){this.modalMaskDomElement.style.cssText=
"position:absolute;display:none";if(this._rootElementOverflow!=-1){if(aria.core.Browser.isFirefox){var a=aria.utils.Dom._getDocumentScroll();this._rootElement.style.overflow=this._rootElementOverflow;this._rootElement.scrollTop=a.scrollTop;this._rootElement.scrollLeft=a.scrollLeft}else this._rootElement.style.overflow=this._rootElementOverflow;this._rootElementOverflow=-1}}}},_isValidAnchor:function(a){a=a.split(" ");if(a.length>2)return false;for(var b=0,c=a.length;b<c;b++)if(!aria.utils.Array.contains(this.ANCHOR_KEYS,
a[b]))return false;return true},_isValidPosition:function(a){return this._isValidAnchor(a.reference)&&this._isValidAnchor(a.popup)},_onMouseOutTimeout:function(){this._detachMouseOverListener();this.close()},_show:function(){if(this.modalMaskDomElement){if(this._rootElementOverflow==-1){this._rootElementOverflow=this._rootElement.style.overflow;if(aria.core.Browser.isFirefox){var a=aria.utils.Dom._getDocumentScroll();this._rootElement.style.overflow="hidden";this._rootElement.scrollTop=a.scrollTop;
this._rootElement.scrollLeft=a.scrollLeft}else this._rootElement.style.overflow="hidden"}a=aria.utils.Dom._getViewportSize();var b=this._rootElement.scrollWidth,c=this._rootElement.scrollHeight;c=Math.max(a.height,c);b=Math.max(a.width,b);this.computedStyle=this._getComputedStyle();this.modalMaskDomElement.style.cssText=["left:0px;top:0px;width:",b,"px;height:",c,"px;z-index:",this.computedStyle.zIndex,";position:absolute;display:block;"].join("")}else this.computedStyle=this._getComputedStyle();
this.domElement.style.cssText=["height:",this.computedStyle.height,"px;width:",this.computedStyle.width,"px;top:",this.computedStyle.top,"px;left:",this.computedStyle.left,"px;z-index:",this.computedStyle.zIndex,";position:absolute;display:inline-block;"].join("");if(aria.core.Browser.isIE7&&!this.isOpen)this.conf.tagDomElement?this.conf.tagDomElement.appendChild(this.domElement):this._document.body.appendChild(this.domElement)},refresh:function(){this.isOpen&&this._show()},moveTo:function(a){if(a){if("center"in
a)this.conf.center=a.center;"absolutePosition"in a&&this.setPositionAsReference(a.absolutePosition)}this.refresh();this.refreshProcessingIndicators()},cancelMouseOutTimer:function(){this._mouseOutTimer&&this._clearMouseOutTimer()},close:function(a){if(this.isOpen){a={name:"onBeforeClose",cancelClose:false,domEvent:a};this.$raiseEvent(a);if(!a.cancelClose){this._hide();this.isOpen=false;aria.popups.PopupManager.onPopupClose(this);this.$raiseEvent("onAfterClose")}}},closeOnMouseClick:function(a){if(this.conf.closeOnMouseClick){this.close(a);
return true}},closeOnMouseOut:function(a){if(this.conf.closeOnMouseOut)if(this.conf.closeOnMouseOutDelay){this.cancelMouseOutTimer();this._mouseOutTimer=aria.core.Timer.addCallback({fn:this._onMouseOutTimeout,scope:this,delay:this.conf.closeOnMouseOutDelay});this._attachMouseOverListener()}else this.close(a)},closeOnMouseScroll:function(a){if(this.conf.closeOnMouseScroll){this.close(a);return true}},getDomElement:function(){return this.domElement},open:function(a){if(!this.isOpen){this.$raiseEvent("onBeforeOpen");
this._applyConfig(a);this._show();this.isOpen=true;aria.popups.PopupManager.onPopupOpen(this);this.refreshProcessingIndicators();this.$raiseEvent("onAfterOpen")}},setPreferredPositions:function(a){this.preferredPositions=[];for(var b=0,c=a.length;b<c;b++){var d=a[b];if(this._isValidPosition(d))this.preferredPositions[this.preferredPositions.length]=d}},setPositionAsReference:function(a){a={top:a.top,left:a.left};this.reference=null;this.referencePosition=a;this.referenceSize={height:0,width:0}},setReference:function(a){var b=
aria.utils.Size.getSize(a),c=aria.utils.Dom;c.scrollIntoView(a);c=c.calculatePosition(a);this.reference=a;this.referencePosition=c;this.referenceSize=b},setSection:function(a){aria.utils.Dom.replaceHTML(this.domElement,a.html);a.initWidgets();this.section=a},refreshProcessingIndicators:function(){this.section&&this.section.refreshProcessingIndicator(true)}}});
//YpwKgK3gnz
//LOGICAL-PATH:aria/popups/PopupManager.js
//YpwKgK3gnz
(function(){var f=null,h=null,g=null;Aria.classDefinition({$classpath:"aria.popups.PopupManager",$dependencies:["aria.DomEvent","aria.utils.Event","aria.utils.Array","aria.utils.Dom","aria.utils.Math","aria.templates.NavigationManager","aria.utils.AriaWindow"],$events:{modalPopupPresent:{description:"Notifies that a modal popup has been opened when no other modal popup was already opened."},modalPopupAbsent:{description:"Notifies that a modal popup has been closed when no other modal popup remains open."},
popupOpen:{description:"Notifies that a popup has been opened.",properties:{popup:"Reference to the popup"}},popupClose:{description:"Notifies that a popup has been closed",properties:{popup:"Reference to the popup"}}},$onload:function(){f=aria.utils.Array;h=aria.utils.Dom;g=aria.utils.Event},$onunload:function(){g=h=f=null},$singleton:true,$constructor:function(){this.openedPopups=[];this.modalPopups=0;this.popups=[];this.currentZIndex=this.baseZIndex=2E4;aria.utils.AriaWindow.$on({unloadWindow:this._reset,
scope:this})},$destructor:function(){aria.utils.AriaWindow.$unregisterListeners(this);this._reset()},$prototype:{_reset:function(){this._closeAllPopups();this._unregisterAllPopups();this.disconnectEvents()},_closeAllPopups:function(){for(var a=this.openedPopups.length-1;a>=0;a--)this.openedPopups[a].close()},_isEventInsidePopup:function(a,c){var b=aria.utils.Dom._getDocumentScroll();b={top:a.clientY+b.scrollTop,left:a.clientX+b.scrollLeft};var d={top:c.computedStyle.top,left:c.computedStyle.left},
e={width:c.computedStyle.width,height:c.computedStyle.height};return b.top>=d.top&&b.left>=d.left&&b.top<=d.top+e.height&&b.left<=d.left+e.width},_unregisterAllPopups:function(){for(var a=this.popups.length-1;a>=0;a--)this.unregisterPopup(this.popups[a])},connectEvents:function(){this.disconnectEvents();aria.utils.AriaWindow.attachWindow();this._document=Aria.$window.document;g.addListener(this._document,"mousedown",{fn:this.onDocumentClick,scope:this},true);g.addListener(this._document,"mouseout",
{fn:this.onDocumentMouseOut,scope:this},true);g.addListener(this._document,"mousewheel",{fn:this.onDocumentMouseScroll,scope:this},true)},disconnectEvents:function(){if(this._document){g.removeListener(this._document,"mousedown",{fn:this.onDocumentClick});g.removeListener(this._document,"mouseout",{fn:this.onDocumentMouseOut});g.removeListener(this._document,"mousewheel",{fn:this.onDocumentMouseScroll});aria.utils.AriaWindow.detachWindow();this._document=null}},connectModalEvents:function(){g.addListener(this._document.body,
"focusin",{fn:this.onDocumentFocusIn,scope:this})},disconnectModalEvents:function(){g.removeListener(this._document.body,"focusin",{fn:this.onDocumentFocusIn})},getZIndexForPopup:function(){this.currentZIndex+=10;return this.currentZIndex},hide:function(a){a.close();a.$dispose()},onDocumentFocusIn:function(a){a=new aria.DomEvent(a);var c=a.target;if(c!=this._document.body)for(var b=this.openedPopups.length-1;b>=0;b--){var d=this.openedPopups[b];if(h.isAncestor(c,d.getDomElement()))break;if(d.modalMaskDomElement){aria.templates.NavigationManager.focusFirst(d.domElement);
break}}a.$dispose()},onDocumentClick:function(a){a=new aria.DomEvent(a);var c=a.target;if(this.openedPopups.length!=0){for(var b=this.openedPopups[this.openedPopups.length-1],d=false,e=0,i=b._ignoreClicksOn.length;e<i;e++)if(h.isAncestor(c,b._ignoreClicksOn[e])){d=true;break}d||h.isAncestor(c,b.getDomElement())||b.closeOnMouseClick(a)}a.$dispose()},onDocumentMouseOut:function(a){a=new aria.DomEvent(a);for(var c=a.target,b=a.relatedTarget,d=this.openedPopups.length-1;d>=0;d--){var e=this.openedPopups[d];
!h.isAncestor(b,e.getDomElement())&&h.isAncestor(c,e.getDomElement())&&e.closeOnMouseOut(a)}a.$dispose()},onDocumentMouseScroll:function(a){a=new aria.DomEvent(a);for(var c=a.target,b=this.openedPopups.length-1;b>=0;b--){var d=this.openedPopups[b];if(!h.isAncestor(c,d.getDomElement()))if(d.closeOnMouseScroll(a))break}a.$dispose()},onPopupOpen:function(a){f.isEmpty(this.openedPopups)&&this.connectEvents();if(a.modalMaskDomElement){if(this.modalPopups==0){this.connectModalEvents();this.$raiseEvent("modalPopupPresent")}this.modalPopups+=
1}this.openedPopups.push(a);this.$raiseEvent({name:"popupOpen",popup:a})},onPopupClose:function(a){f.remove(this.openedPopups,a);if(a.modalMaskDomElement){this.modalPopups-=1;if(this.modalPopups==0){this.disconnectModalEvents();this.$raiseEvent("modalPopupAbsent")}}f.isEmpty(this.openedPopups)&&this.disconnectEvents();this.$raiseEvent({name:"popupClose",popup:a})},registerPopup:function(a){f.contains(this.popups,a)||this.popups.push(a)},show:function(a){var c=new aria.popups.Popup;c.open(a);return c},
unregisterPopup:function(a){f.contains(this.openedPopups,a)&&f.remove(this.openedPopups,a);f.contains(this.popups,a)&&f.remove(this.popups,a);if(f.isEmpty(this.openedPopups))this.currentZIndex=this.baseZIndex},getPopupFromDom:function(a){for(var c=this.popups,b=0,d=c.length;b<d;b++){var e=c[b];if(e.domElement==a)return e}return null}}})})();